# 1.财务规范化-主数据控制

## 1.1财务规范化-供应商相关控制

### 1.1.1主供应商新增/修改相关控制

-  必填字段：供应商名称、联系人、电话号码、注册地址、供应商类型、供应商状态、公司类型、省份、城市、区县、法人代表、级别、票种、纳税人身份、社会信用代码。
-  其中供应商名称只能包含中文或者括号，供应商名称不能重复，供应商名称不能超过100个字符
-  票种分为：普票、专票
-  纳税人身份分为：小规模纳税人、一般纳税人
-  社会信用代码：不能重复
-  在修改供应商时已经结束修改的供应商，不能再结束修改。
-  修改供应商时只能修改当前用户修改的记录，若需修改他人记录，则需点击![](E:\picture\003.png)后修改
-  预付功能：预付比例、预付开始时间、预付结束时间，预付比例一旦设置则预付开始时间、结束时间不能为空

### 1.1.2主/辅供应商继承关系

- 子供应商在主供应商新增完成后点击结束修改按钮，子供应商自动继承（除仓库、分部、供应商状态、供应商级别、供应商批发占比、供应商加价比例、备注外）主供应商的其他属性

  ```
  Select * From mdmsys.actions a Where a.actionid = 9050;
  ```

- 子供应商设置了仓库和分部后如果数据已经传给中心那么将不能再修改

  ```
  Create Or Replace Trigger Tr_Bf_IU_DIC_Supplier
  Before Insert or Update on MDMDATA.DIC_SUPPLIER
  For each Row
  Begin
    If :New.Parentid Is Null And :New.Sup_Name <> :Old.Sup_Name And
       Lengthb(:New.Sup_Name) > 100 Then
      Raise_Application_Error(-20002, '供应商名称不能超过100个字符！');
    End If;
    If Inserting Then
      If :New.Parentid Is Null And :New.Sup_Name <> Nvl(:Old.Sup_Name, ' ') Then
        :New.Sup_Name := :New.Sup_Name || '*';
      End If;
    Elsif Updating Then
      If (:Old.Lastpublishtime Is Not Null Or
         :New.Lastpublishtime Is Not Null) And :Old.Sho_Id <> :New.Sho_Id Then
        Raise_Application_Error(-20002, '已经发布的供应商数据不可修改仓库！');
      End If;
    End If;
  End;
  ```

  

-  已经发布的子供应商除供应商状态、供应商级别、供应商批发占比、供应商加价比例、备注外其他属性不能修改

## 1.2财务规范化-商品相关控制

-  映射字段、税票编码、执行标准、安全技术类别：根据商品税票编码基础表数据给默认值（DIC_CLS_TAX）
-  最低批发占比：所有分部开票供应商设置为【0.1】
-  小规模税率：所有分部默认值为【0.01】

# 2.财务规范化-中心控制

## 2.1财务规范化-订货篮订货功能控制

- 所选商品如果不开票则不可加入试点店

## 2.2财务规范化-采购单控制（SP\CP）

- 导入的数据中试点店商品最低批发占比不能小于等于0
- 供应商批发占比字段在选择供应商时系统自动赋值
- 在新增和修改ORDERS_REQUEST表的商品时，系统自动将商品的最低批发占比赋值给最低批发占比字段
- 如商品是不开票则不能下单给试点店

## 2.3财务规范化-ASN预约控制（SP\CP）

- 如商品是不开票则不分货给试点店，系统自动将试点店订货量分给GZY


## 2.4财务规范化-调配控制

- 目前系统控制已经取消，不管开票是否都可调配至试点店


## 2.5财务规范化-调拨单控制

- 试点店商品可调拨至非试点店、电商、试点店
- 非试点店商品可以调拨至非试点店
- 非试点店不开票商品不能调拨至试点店、电商
- 非试点店开票商品可调拨至试点店、电商
- 电商商品可调拨至试点店、非试点店
- 目标店接受商品时不控制商品是否开票与门店属性关系



